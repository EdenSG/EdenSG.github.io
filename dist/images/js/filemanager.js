$(function(){var a=$(".filemanager"),b=$(".breadcrumbs"),c=a.find(".data");$.get("scan.php",function(d){function e(b){if(b=decodeURIComponent(b).slice(1).split("="),b.length){var c="";"search"===b[0]?(a.addClass("searching"),c=h(l,b[1].toLowerCase()),c.length?(m=b[0],i(c)):i(c)):b[0].trim().length?(c=g(b[0]),c.length?(m=b[0],n=f(b[0]),i(c)):(m=b[0],n=f(b[0]),i(c))):(m=d.path,n.push(d.path),i(g(d.path)))}}function f(a){for(var b=a.split("/").slice(0),c=1;c<b.length;c++)b[c]=b[c-1]+"/"+b[c];return b}function g(a){for(var b=a.split("/"),c=l,d=0,e=0;e<b.length;e++)for(var f=0;f<c.length;f++)if(c[f].name===b[e]){d=1,c=c[f].items;break}return c=d?c:[]}function h(a,b){return a.forEach(function(a){"folder"===a.type?(h(a.items,b),a.name.toLowerCase().match(b)&&o.push(a)):"file"===a.type&&a.name.toLowerCase().match(b)&&p.push(a)}),{folders:o,files:p}}function i(d){var e=[],f=[];Array.isArray(d)?d.forEach(function(a){"folder"===a.type?e.push(a):"file"===a.type&&f.push(a)}):"object"==typeof d&&(e=d.folders,f=d.files),c.empty().hide(),e.length||f.length?a.find(".nothingfound").hide():a.find(".nothingfound").show(),e.length&&e.forEach(function(a){var b=a.items.length,d=j(a.name),e='<span class="icon folder"></span>';b&&(e='<span class="icon folder full"></span>'),1==b?b+=" item":b>1?b+=" items":b="Empty";var f=$('<li class="folders"><a href="'+a.path+'" title="'+a.path+'" class="folders">'+e+'<span class="name">'+d+'</span> <span class="details">'+b+"</span></a></li>");f.appendTo(c)}),f.length&&f.forEach(function(a){var b=k(a.size),d=j(a.name),e=d.split("."),f='<span class="icon file"></span>';e=e[e.length-1],f='<span class="icon file f-'+e+'">.'+e+"</span>";var g=$('<li class="files"><a href="'+a.path+'" title="'+a.path+'" class="files">'+f+'<span class="name">'+d+'</span> <span class="details">'+b+"</span></a></li>");g.appendTo(c)});var g="";a.hasClass("searching")?(g="<span>Search results: </span>",c.removeClass("animated")):(c.addClass("animated"),n.forEach(function(a,b){var c=a.split("/");g+=b!==n.length-1?'<a href="'+a+'"><span class="folderName">'+c[c.length-1]+'</span></a> <span class="arrow">â†’</span> ':'<span class="folderName">'+c[c.length-1]+"</span>"})),b.text("").append(g),c.animate({display:"inline-block"})}function j(a){return a.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}function k(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Bytes";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]}var l=[d],m="",n=[],o=[],p=[];$(window).on("hashchange",function(){e(window.location.hash)}).trigger("hashchange"),a.find(".search").click(function(){var a=$(this);a.find("span").hide(),a.find("input[type=search]").show().focus()}),a.find("input").on("input",function(){o=[],p=[];var b=this.value.trim();b.length?(a.addClass("searching"),window.location.hash="search="+b.trim()):(a.removeClass("searching"),window.location.hash=encodeURIComponent(m))}).on("keyup",function(a){var b=$(this);27==a.keyCode&&b.trigger("focusout")}).focusout(function(){var a=$(this);a.val().trim().length||(window.location.hash=encodeURIComponent(m),a.hide(),a.parent().find("span").show())}),c.on("click","li.folders",function(b){b.preventDefault();var c=$(this).find("a.folders").attr("href");a.hasClass("searching")?(n=f(c),a.removeClass("searching"),a.find("input[type=search]").val("").hide(),a.find("span").show()):n.push(c),window.location.hash=encodeURIComponent(c),m=c}),b.on("click","a",function(a){a.preventDefault();var c=b.find("a").index($(this)),d=n[c];n.length=Number(c),window.location.hash=encodeURIComponent(d)})})});